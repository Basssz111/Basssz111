<!DOCTYPE html>
<html>
<head>
  <title>MTL</title>
  <style>
    body { margin: 0; overflow: hidden; background: #000; }
  </style>
</head>
<body>
  <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/build/three.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/loaders/MTLLoader.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/loaders/OBJLoader.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/controls/OrbitControls.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/dat.gui@0.7.9/build/dat.gui.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/loaders/GLTFLoader.js"></script>

  <script>
    const scene = new THREE.Scene();

    // พื้นหลัง
    const bgTexture = new THREE.TextureLoader().load('https://basssz111.github.io/Basssz111/final/belfast_sunset_1k.png');
    scene.background = bgTexture;

    // Renderer
    const renderer = new THREE.WebGLRenderer({ antialias: true });
    renderer.setSize(window.innerWidth, window.innerHeight);
    renderer.shadowMap.enabled = true;
    document.body.appendChild(renderer.domElement);

    // กล้อง
    const camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.01, 1000);
    camera.position.set(-8.5, 1.3, 0.1);

    const controls = new THREE.OrbitControls(camera, renderer.domElement);
    controls.target.set(0, 0, 1);
    controls.minDistance = 1;
    controls.maxDistance = 20;
    controls.update();

    const defaultCameraPos = camera.position.clone(); // เก็บตำแหน่งกล้องเริ่มต้น
    let preventCameraMove = false;

    // ฟังก์ชันบังคับกล้องกลับตำแหน่งเดิม
    function lockCameraToDefault() {
      if (preventCameraMove) {
        camera.position.lerp(defaultCameraPos, 0.1);
        controls.target.lerp(new THREE.Vector3(0, 0, 1), 0.1);
        controls.update();
      }
    }

    // ใน loop animate เพิ่มบรรทัดนี้
    function animate() {
      requestAnimationFrame(animate);
      lockCameraToDefault(); // ✅ ถ้าอยู่ในโหมดล็อกกล้อง กล้องจะกลับเอง
      renderer.render(scene, camera);
    }

    controls.target.set(0, 0, 1);
    controls.update();

    // พื้น
    const groundTexture = new THREE.TextureLoader().load('https://basssz111.github.io/Basssz111/final/rock_wall_15_diff_1k.jpg');
    groundTexture.wrapS = groundTexture.wrapT = THREE.RepeatWrapping;
    groundTexture.repeat.set(8, 8);
    const groundMaterial = new THREE.MeshStandardMaterial({ map: groundTexture, roughness: 0.8 });
    const ground = new THREE.Mesh(new THREE.PlaneGeometry(10, 10), groundMaterial);
    ground.rotation.x = -Math.PI / 2;
    ground.receiveShadow = true;
    scene.add(ground);

    // แสง
    scene.add(new THREE.AmbientLight(0xffe0b2, 1));
    const dirLight = new THREE.DirectionalLight(0xffa366, 3.1);
    dirLight.position.set(5,6, 2);
    dirLight.castShadow = true;
    scene.add(dirLight);

    

    // dat.GUI
    //const gui = new dat.GUI();

    // โหลด projects
    let ProjectsObject = null;
    const mtlLoader = new THREE.MTLLoader();
    mtlLoader.setPath("https://basssz111.github.io/Basssz111/final/");
    mtlLoader.load("Projects.mtl", (materials) => {
      materials.preload();
      const objLoader = new THREE.OBJLoader();
      objLoader.setMaterials(materials);
      objLoader.setPath("https://basssz111.github.io/Basssz111/final/");
      objLoader.load("Projects.obj", (object) => {
        object.scale.set(0.1, 0.1, 0.1);
        object.position.set(-7.2, 0.9, 0.5);
        object.rotation.set(-1.5, -3.1, -1);
        object.traverse(child => {
          if (child.isMesh) {
            child.castShadow = true; 
            child.userData.clickable = true;
            child.userData.name = "projects";
          }
        });
        scene.add(object);
        aboutMeObject = object;
      });
    });
    // โหลด About Me
    let aboutMeObject = null;
    mtlLoader.setPath("https://basssz111.github.io/Basssz111/final/");
    mtlLoader.load("aboutme.mtl", (materials) => {
      materials.preload();
      const objLoader = new THREE.OBJLoader();
      objLoader.setMaterials(materials);
      objLoader.setPath("https://basssz111.github.io/Basssz111/final/");
      objLoader.load("aboutme.obj", (object) => {
        object.scale.set(0.1, 0.1, 0.1);
        object.position.set(-7.2, 1.1, 0.5);
        object.rotation.set(-1.5, -3.1, -1);
        object.traverse(child => {
          if (child.isMesh) {
            child.castShadow = true; 
            child.userData.clickable = true;
            child.userData.name = "aboutMe";
          }
        });
        scene.add(object);
        aboutMeObject = object;
      });
    });

    // โหลด about me info
    let NAMEEObject = null;
    mtlLoader.setPath("https://basssz111.github.io/Basssz111/final/");
    mtlLoader.load("NAMEE.mtl", (materials) => {
      materials.preload();
      const objLoader = new THREE.OBJLoader();
      objLoader.setMaterials(materials);
      objLoader.setPath("https://basssz111.github.io/Basssz111/final/");
      objLoader.load("NAMEE.obj", (object) => {
        object.scale.set(0.1, 0.1, 0.1);
        object.position.set(1.34, 1.3, 0);
        object.rotation.set(-0.3, -0.7, -0.2);
        object.traverse(child => {
          if (child.isMesh) {
            child.castShadow = true;
            child.userData.clickable = true;
            child.userData.name = "aboutMe";
          }
        });
        scene.add(object);
        NAMEEObject = object;
      });
    });

    const textureLoader = new THREE.TextureLoader();
        const picTexture = textureLoader.load('https://basssz111.github.io/Basssz111/final/9b081f69-f709-4d1d-a787-786b4066ac74.jpg');
        const geo = new THREE.BoxGeometry(1, 1, 0.1);
        const mat = new THREE.MeshBasicMaterial({ map: picTexture });
        const Mesh = new THREE.Mesh(geo, mat);
        Mesh.scale.set(1.5, 1.5, 0.5);
        Mesh.position.set(1, 1.5, -0.9);
        Mesh.rotation.set(-0.3, -0.7, -0.2);
        scene.add(Mesh);

    // โหลด back
    let backObject = null;
    mtlLoader.setPath("https://basssz111.github.io/Basssz111/final/");
    mtlLoader.load("back.mtl", (materials) => {
      materials.preload();
      const objLoader = new THREE.OBJLoader();
      objLoader.setMaterials(materials);
      objLoader.setPath("https://basssz111.github.io/Basssz111/final/");
      objLoader.load("back.obj", (object) => {
        object.scale.set(0.1, 0.1, 0.1);
        object.position.set(1.56, 1.3, 1.6);
        object.rotation.set(-1.7, -2.9, -1.9);
        object.traverse(child => {
          if (child.isMesh) {
            child.castShadow = true;
            child.userData.clickable = true;
            child.userData.name = "back";
          }
        });
        scene.add(object);
        backObject = object;

      });
    });
    let backObject2 = null;
    mtlLoader.setPath("https://basssz111.github.io/Basssz111/final/");
    mtlLoader.load("back.mtl", (materials) => {
      materials.preload();
      const objLoader = new THREE.OBJLoader();
      objLoader.setMaterials(materials);
      objLoader.setPath("https://basssz111.github.io/Basssz111/final/");
      objLoader.load("back.obj", (object) => {
        object.scale.set(0.1, 0.1, 0.1);
        object.position.set(1.65, 0.1, 2.6);
        object.rotation.set(-1.6, -3.15, 0);
        object.traverse(child => {
          if (child.isMesh) {
            child.castShadow = true;
            child.userData.clickable = true;
            child.userData.name = "back";
          }
        });
        scene.add(object);
        backObject2 = object;
      });
    });
     // โหลด left
    let LeftObject = null;
    mtlLoader.setPath("https://basssz111.github.io/Basssz111/final/");
    mtlLoader.load("LEFT.mtl", (materials) => {
      materials.preload();
      const objLoader = new THREE.OBJLoader();
      objLoader.setMaterials(materials);
      objLoader.setPath("https://basssz111.github.io/Basssz111/final/");
      objLoader.load("LEFT.obj", (object) => {
        object.scale.set(0.1, 0.1, 0.1);
        object.position.set(2.1, -0.05, 2.45);
        object.rotation.set(-0.3, -2.6, 0);
        object.traverse(child => {
          if (child.isMesh) {
            child.castShadow = true;
            child.userData.clickable = true;
            child.userData.name = "LEFT";
          }
        });
        scene.add(object);
        LeftObject = object;
      });
    });
     // โหลด right
    let RightObject = null;
    mtlLoader.setPath("https://basssz111.github.io/Basssz111/final/");
    mtlLoader.load("RIGHT.mtl", (materials) => {
      materials.preload();
      const objLoader = new THREE.OBJLoader();
      objLoader.setMaterials(materials);
      objLoader.setPath("https://basssz111.github.io/Basssz111/final/");
      objLoader.load("RIGHT.obj", (object) => {
        object.scale.set(0.085, 0.085, 0.085);
        object.position.set(1.2, 0, 2.4);
        object.rotation.set(-0.13, 2.6, 0);
        object.traverse(child => {
          if (child.isMesh) {
            child.castShadow = true;
            child.userData.clickable = true;
            child.userData.name = "RIGHT";
          }
        });
        scene.add(object);
        RightObject = object;
      });
    });

    // GLTF Model
    const gltfLoader = new THREE.GLTFLoader();
    gltfLoader.load('https://basssz111.github.io/Basssz111/final/saloonOBJ.glb', (gltf) => {
      const model = gltf.scene;
      model.traverse(c => {
        if (c.isMesh) { c.castShadow = true; c.receiveShadow = true; }
      });
      model.rotation.y = -Math.PI / 2;
      scene.add(model);
    });
    gltfLoader.load('https://basssz111.github.io/Basssz111/final/saloonflow.glb', (gltf) => {
      const model = gltf.scene;
      model.traverse(c => {
        if (c.isMesh) { c.castShadow = true; c.receiveShadow = true; }
      });
      model.rotation.y = -Math.PI / 2;
      scene.add(model);
    });
    
    gltfLoader.load('https://basssz111.github.io/Basssz111/final/KUFIX.glb', (gltf) => {
      const model = gltf.scene;
      model.traverse(c => {
        if (c.isMesh) { c.castShadow = true; c.receiveShadow = true; }
      });
      model.position.set(0, 0.9, -1);
      model.rotation.set(0, -0.7, 0);
      scene.add(model);
      const kuFolder = gui.addFolder('KU Logo');
      kuFolder.add(model.position, 'x', -10, 10).name('Position X');
      kuFolder.add(model.position, 'y', -10, 10).name('Position Y');
      kuFolder.add(model.position, 'z', -10, 10).name('Position Z');
      kuFolder.add(model.rotation, 'x', -Math.PI, Math.PI).name('Rotate X');
      kuFolder.add(model.rotation, 'y', -Math.PI, Math.PI).name('Rotate Y');
      kuFolder.add(model.rotation, 'z', -Math.PI, Math.PI).name('Rotate Z');
      kuFolder.add(model.scale, 'x', 0.01, 2).name('Scale X');
      kuFolder.add(model.scale, 'y', 0.01, 2).name('Scale Y');
      kuFolder.add(model.scale, 'z', 0.01, 2).name('Scale Z');
      kuFolder.open();
    });

    const clock = new THREE.Clock();
    let mixer = null;

    // โหลดโมเดล Cowboy
    gltfLoader.load(
    'https://basssz111.github.io/Basssz111/final/cowboy/cowboylowscale.glb', // เปลี่ยนเป็นพาธ/URL ของโมเดลของคุณ
    (gltf) => { 
    const model = gltf.scene || gltf.scenes[0];
    model.traverse((node) => { 
    if (node.isMesh) { 
    // ถ้าวัสดุเป็น MeshStandardMaterial ให้ใช้ envMap ของฉากเพื่อสะท้อน 
    if (node.material && (node.material.isMeshStandardMaterial || node.material.isMeshPhysicalMaterial)){
       node.material.needsUpdate = true;
      } 
    } 
  }); // Setup AnimationMixer and play animations (if any) 
    if (gltf.animations && gltf.animations.length) {
      mixer = new THREE.AnimationMixer(model); 
      // เล่นทุกคลิป — ถ้าต้องการเล่นแค่คลิปแรกใช้ 
      mixer.clipAction(gltf.animations[0]).play();
      gltf.animations.forEach((clip) => { 
      const action = mixer.clipAction(clip); 
      action.play(); 
     }); 
    } 
    model.position.set(-5.6, 0.1, -0.3); 
    model.scale.set(1.3, 1.3, 1.3); 
    model.rotation.set(0, 4.5, 0); 
    scene.add(model);
    }, 
    undefined, 
    (error) => { 
    console.error('Error loading glTF:', error); 
    } 
  );

    // โหลดโมเดล weed
    gltfLoader.load(
      'https://basssz111.github.io/Basssz111/final/weed/weedlowscale.glb',
      (gltf) => {
        const model = gltf.scene || gltf.scenes[0];
        model.traverse((node) => {
          if (node.isMesh) {
            // สร้าง ShaderMaterial สำหรับ vertex displacement
            node.material = new THREE.ShaderMaterial({
              uniforms: {
                time: { value: 0 }
              },
              vertexShader: `
                uniform float time;
                varying vec2 vUv;
                void main() {
                  vUv = uv;
                  vec3 newPosition = position;
                  // ขยับ vertex แบบ wave
                  newPosition.y += 2.0 * sin(5.0 * position.x + time * 2.0);
                  newPosition.x += 1.5 * sin(3.0 * position.y + time * 1.5);
                  gl_Position = projectionMatrix * modelViewMatrix * vec4(newPosition, 1.0);
                }
              `,
              fragmentShader: `
                varying vec2 vUv;
                void main() {
                  gl_FragColor = vec4(0.9, 0.87, 0.53, 0.1); // สีเขียว
                }
              `
            });
          }
        });
        model.position.set(-6, 0.1, -2);
        model.scale.set(0.5, 0.5, 0.5);
        model.rotation.set(0, 2.5, 0);
        scene.add(model);

        // อัปเดต uniform time ใน animate loop
        function updateWeedShader() {
          model.traverse((node) => {
            if (node.isMesh && node.material.isShaderMaterial) {
              node.material.uniforms.time.value = performance.now() * 0.001;
            }
          });
          requestAnimationFrame(updateWeedShader);
        }
        updateWeedShader();
      }
    );
    //pointlight
    const lanternLight = new THREE.PointLight(0xffd27f, 3, 5, 2);
    lanternLight.position.set(-3, 1.6, -0.1);
    lanternLight.castShadow = true;
    scene.add(lanternLight);

    //pointlight1
    const lanternLight1 = new THREE.PointLight(0xffd27f, 2.2, 2.8, 2);
    lanternLight1.position.set(5, 1.6, 2.1);
    lanternLight1.castShadow = true;
    scene.add(lanternLight1);


     //pointlight2
    const lanternLight2 = new THREE.PointLight(0xffd27f, 2.2, 2.8, 2);
    lanternLight2.position.set(4.9, 1.6, -0.9);
    lanternLight2.castShadow = true;
    scene.add(lanternLight2);


    // Raycaster
    const raycaster = new THREE.Raycaster();
    const mouse = new THREE.Vector2();

    function handlePick(x, y) {
      const rect = renderer.domElement.getBoundingClientRect();
      mouse.x = ((x - rect.left) / rect.width) * 2 - 1;
      mouse.y = -((y - rect.top) / rect.height) * 2 + 1;

      raycaster.setFromCamera(mouse, camera);
      const intersects = raycaster.intersectObjects(scene.children, true);

      if (intersects.length > 0) {
        const clicked = intersects.find(i => i.object.userData && i.object.userData.clickable);
        if (clicked && clicked.object.userData.name === "projects") {
          // เคลื่อนกล้องไปหน้า Project
          const startPos = camera.position.clone();
          const targetPos = new THREE.Vector3(1.5, 0.2, 1.6);
          const lookAtPos = new THREE.Vector3(1.4, 2.6, 6);
          const duration = 144;
          let frame = 0;
          function moveCamera() {
            frame++;
            const t = frame / duration;
            camera.position.lerpVectors(startPos, targetPos, t);
            controls.target.lerpVectors(controls.target.clone(), lookAtPos, t);
            controls.update();
            if (frame < duration) requestAnimationFrame(moveCamera);
          }
          moveCamera();
        }
        else if (clicked && clicked.object.userData.name === "aboutMe") {
          // เคลื่อนกล้องไปหน้า aboutMe
          const startPos = camera.position.clone();
          const targetPos = new THREE.Vector3(0, 2, 2);
          const lookAtPos = new THREE.Vector3(3, 1, 0);
          const duration = 144;

          let frame = 0;
          //controls.enabled = false; //  ปิดการควบคุมกล้องจาก user

          function moveCamera() {
            frame++;
            const t = frame / duration;
            camera.position.lerpVectors(startPos, targetPos, t);
            controls.target.lerpVectors(controls.target.clone(), lookAtPos, t);
            controls.update();
            if (frame < duration) requestAnimationFrame(moveCamera);
          }
          moveCamera();
        }
        else if (clicked && clicked.object.userData.name === "back") {
          const startPos = camera.position.clone();
          const targetPos = new THREE.Vector3(-8.5, 1.3, 0.1); // กลับไปตำแหน่งเริ่มต้น
          const lookAtPos = new THREE.Vector3(3, 1, 0);
          const duration = 144; 
          let frame = 0;

          function resetCamera() {
            frame++;
            const t = frame / duration;
            camera.position.lerpVectors(startPos, targetPos, t);
            controls.target.lerpVectors(controls.target.clone(), lookAtPos, t);
            controls.update();
            if (frame < duration) requestAnimationFrame(resetCamera);
          }
          resetCamera();
        }
      }
    }
    // Mouse click
    window.addEventListener('click', (event) => {
      handlePick(event.clientX, event.clientY);
    });

    // Touch (มือถือ)
    window.addEventListener('touchstart', (event) => {
      if (event.touches.length > 0) {
        handlePick(event.touches[0].clientX, event.touches[0].clientY);
      }
    });

  // Render loop
  function animate() {
    requestAnimationFrame(animate);
    const delta = clock.getDelta();
    if (mixer) mixer.update(delta);
    renderer.render(scene, camera);
  }
  animate();

    // Animate loop
    window.addEventListener('resize', () => {
      camera.aspect = window.innerWidth / window.innerHeight;
      camera.updateProjectionMatrix();
      renderer.setSize(window.innerWidth, window.innerHeight);
    });
  </script>
</body>
</html>
