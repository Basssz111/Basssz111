<!DOCTYPE html>
<html>
<head>
  <title>MTL</title>
  <style>
    body { margin: 0; overflow: hidden; background: #000; }
  </style>
</head>
<body>
  <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/build/three.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/loaders/MTLLoader.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/loaders/OBJLoader.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/controls/OrbitControls.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/dat.gui@0.7.9/build/dat.gui.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/loaders/GLTFLoader.js"></script>

  <script>
    const scene = new THREE.Scene();

    // พื้นหลัง
    const bgTexture = new THREE.TextureLoader().load('https://basssz111.github.io/Basssz111/final/belfast_sunset_1k.png');
    scene.background = bgTexture;

    // Renderer
    const renderer = new THREE.WebGLRenderer({ antialias: true });
    renderer.setSize(window.innerWidth, window.innerHeight);
    renderer.shadowMap.enabled = true;
    document.body.appendChild(renderer.domElement);

    // กล้อง
    const camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
    camera.position.set(-9.5, 1, 0.1);

    const controls = new THREE.OrbitControls(camera, renderer.domElement);
    const defaultCameraPos = camera.position.clone(); // เก็บตำแหน่งกล้องเริ่มต้น
    let preventCameraMove = false;

    // ฟังก์ชันบังคับกล้องกลับตำแหน่งเดิม
    function lockCameraToDefault() {
      if (preventCameraMove) {
        camera.position.lerp(defaultCameraPos, 0.1);
        controls.target.lerp(new THREE.Vector3(0, 0, 1), 0.1);
        controls.update();
      }
    }

    // ใน loop animate เพิ่มบรรทัดนี้
    function animate() {
      requestAnimationFrame(animate);
      lockCameraToDefault(); // ✅ ถ้าอยู่ในโหมดล็อกกล้อง กล้องจะกลับเอง
      renderer.render(scene, camera);
    }

    controls.target.set(0, 0, 1);
    controls.update();

    // พื้น
    const groundTexture = new THREE.TextureLoader().load('https://basssz111.github.io/Basssz111/final/rock_wall_15_diff_1k.jpg');
    groundTexture.wrapS = groundTexture.wrapT = THREE.RepeatWrapping;
    groundTexture.repeat.set(8, 8);
    const groundMaterial = new THREE.MeshStandardMaterial({ map: groundTexture, roughness: 0.8 });
    const ground = new THREE.Mesh(new THREE.PlaneGeometry(10, 10), groundMaterial);
    ground.rotation.x = -Math.PI / 2;
    ground.receiveShadow = true;
    scene.add(ground);

    // แสง
    scene.add(new THREE.AmbientLight(0xffffff, 0.4));
    const dirLight = new THREE.DirectionalLight(0xffffff, 1);
    dirLight.position.set(5, 10, 5);
    dirLight.castShadow = true;
    scene.add(dirLight);

    // dat.GUI
    const gui = new dat.GUI();

    // โหลด About Me
    let aboutMeObject = null;
    const mtlLoader = new THREE.MTLLoader();
    mtlLoader.setPath("https://basssz111.github.io/Basssz111/final/");
    mtlLoader.load("Projects.mtl", (materials) => {
      materials.preload();
      const objLoader = new THREE.OBJLoader();
      objLoader.setMaterials(materials);
      objLoader.setPath("https://basssz111.github.io/Basssz111/final/");
      objLoader.load("Projects.obj", (object) => {
        object.scale.set(0.1, 0.1, 0.1);
        object.position.set(-8.5, 0.8, 0.5);
        object.rotation.set(-1.5, -3.1, -1);
        object.traverse(child => {
          if (child.isMesh) {
            child.castShadow = true;
            child.userData.clickable = true;
            child.userData.name = "aboutMe";
          }
        });
        scene.add(object);
        aboutMeObject = object;
      });
    });

    // โหลด about me info
    let NAMEEObject = null;
    mtlLoader.setPath("https://basssz111.github.io/Basssz111/final/");
    mtlLoader.load("NAMEE.mtl", (materials) => {
      materials.preload();
      const objLoader = new THREE.OBJLoader();
      objLoader.setMaterials(materials);
      objLoader.setPath("https://basssz111.github.io/Basssz111/final/");
      objLoader.load("NAMEE.obj", (object) => {
        object.scale.set(0.1, 0.1, 0.1);
        object.position.set(1.34, 1.3, 0);
        object.rotation.set(-0.3, -0.7, -0.2);
        object.traverse(child => {
          if (child.isMesh) {
            child.castShadow = true;
            child.userData.clickable = true;
            child.userData.name = "aboutMe";
          }
        });
        scene.add(object);
        NAMEEObject = object;
    // เพิ่ม UI dat.GUI ควบคุม back.obj
    const NAMEEFolder = gui.addFolder('NAMEE Object');
    NAMEEFolder.add(object.position, 'x', -10, 10).name('Position X');
    NAMEEFolder.add(object.position, 'y', -10, 10).name('Position Y');
    NAMEEFolder.add(object.position, 'z', -10, 10).name('Position Z');
    NAMEEFolder.add(object.rotation, 'x', -Math.PI, Math.PI).name('Rotate X');
    NAMEEFolder.add(object.rotation, 'y', -Math.PI, Math.PI).name('Rotate Y');
    NAMEEFolder.add(object.rotation, 'z', -Math.PI, Math.PI).name('Rotate Z');
    NAMEEFolder.add(object.scale, 'x', 0.01, 1).name('Scale');
        NAMEEFolder.open();
      });
    });

    const textureLoader = new THREE.TextureLoader();
        const picTexture = textureLoader.load('https://basssz111.github.io/Basssz111/final/9b081f69-f709-4d1d-a787-786b4066ac74.jpg');
        const geo = new THREE.BoxGeometry(1, 1, 0.1);
        const mat = new THREE.MeshBasicMaterial({ map: picTexture });
        const Mesh = new THREE.Mesh(geo, mat);
        Mesh.scale.set(1.5, 1.5, 0.5);
        Mesh.position.set(1, 1.5, -0.9);
        Mesh.rotation.set(-0.3, -0.7, -0.2);
        scene.add(Mesh);

    // โหลด back
    let backObject = null;
    mtlLoader.setPath("https://basssz111.github.io/Basssz111/final/");
    mtlLoader.load("back.mtl", (materials) => {
      materials.preload();
      const objLoader = new THREE.OBJLoader();
      objLoader.setMaterials(materials);
      objLoader.setPath("https://basssz111.github.io/Basssz111/final/");
      objLoader.load("back.obj", (object) => {
        object.scale.set(0.1, 0.1, 0.1);
        object.position.set(0.9, 1.3, 1.8);
        object.rotation.set(-1.6, -2.7, -1.7);
        object.traverse(child => {
          if (child.isMesh) {
            child.castShadow = true;
            child.userData.clickable = true;
            child.userData.name = "back";
          }
        });
        scene.add(object);
        backObject = object;

        // เพิ่ม UI dat.GUI ควบคุม back.obj
        const backFolder = gui.addFolder('Back Object');
        backFolder.add(object.position, 'x', -10, 10).name('Position X');
        backFolder.add(object.position, 'y', -10, 10).name('Position Y');
        backFolder.add(object.position, 'z', -10, 10).name('Position Z');
        backFolder.add(object.rotation, 'x', -Math.PI, Math.PI).name('Rotate X');
        backFolder.add(object.rotation, 'y', -Math.PI, Math.PI).name('Rotate Y');
        backFolder.add(object.rotation, 'z', -Math.PI, Math.PI).name('Rotate Z');
        backFolder.add(object.scale, 'x', 0.01, 1).name('Scale');
        backFolder.open();
      });
    });

    const pointLight = new THREE.PointLight(0xFFCC66, 0.1, 60); // สี, intensity, distance
    pointLight.position.set(0.9, 1.45, -3.15);
    pointLight.castShadow = true;
    scene.add(pointLight);

    const pointLight1 = new THREE.PointLight(0xFFCC66, 0.4, 60); // สี, intensity, distance
    pointLight1.position.set(2.32, 1.6, 1.8);
    pointLight1.castShadow = true;
    scene.add(pointLight1);

    const pointLight2 = new THREE.PointLight(0xFFCC66, 0.4, 60); // สี, intensity, distance
    pointLight2.position.set(-0.25, 1.65, -3.15);
    pointLight2.castShadow = true;
    scene.add(pointLight2);

    const pointLight3 = new THREE.PointLight(0xFFCC66, 0.7, 60); // สี, intensity, distance
    pointLight3.position.set(2.32, 1.6, -1.17);
    pointLight3.castShadow = true;
    scene.add(pointLight3);

    // GLTF Model
    const gltfLoader = new THREE.GLTFLoader();
    gltfLoader.load('https://basssz111.github.io/Basssz111/final/saloongg.glb', (gltf) => {
      const model = gltf.scene;
      model.traverse(c => {
        if (c.isMesh) { c.castShadow = true; c.receiveShadow = true; }
      });
      model.rotation.y = -Math.PI / 2;
      scene.add(model);
    });
    
    gltfLoader.load('https://basssz111.github.io/Basssz111/final/KU Logo.glb', (gltf) => {
      const model = gltf.scene;
      model.traverse(c => {
        if (c.isMesh) { c.castShadow = true; c.receiveShadow = true; }
      });
      model.position.set(0, 0.9, -1);
      model.rotation.set(0, -0.7, 0);
      scene.add(model);
      const kuFolder = gui.addFolder('KU Logo');
      kuFolder.add(model.position, 'x', -10, 10).name('Position X');
      kuFolder.add(model.position, 'y', -10, 10).name('Position Y');
      kuFolder.add(model.position, 'z', -10, 10).name('Position Z');
      kuFolder.add(model.rotation, 'x', -Math.PI, Math.PI).name('Rotate X');
      kuFolder.add(model.rotation, 'y', -Math.PI, Math.PI).name('Rotate Y');
      kuFolder.add(model.rotation, 'z', -Math.PI, Math.PI).name('Rotate Z');
      kuFolder.add(model.scale, 'x', 0.01, 2).name('Scale X');
      kuFolder.add(model.scale, 'y', 0.01, 2).name('Scale Y');
      kuFolder.add(model.scale, 'z', 0.01, 2).name('Scale Z');
      kuFolder.open();
    });


    // Raycaster
    const raycaster = new THREE.Raycaster();
    const mouse = new THREE.Vector2();

    window.addEventListener('click', (event) => {
      const rect = renderer.domElement.getBoundingClientRect();
      mouse.x = ((event.clientX - rect.left) / rect.width) * 2 - 1;
      mouse.y = -((event.clientY - rect.top) / rect.height) * 2 + 1;

      raycaster.setFromCamera(mouse, camera);
      const intersects = raycaster.intersectObjects(scene.children, true);

      if (intersects.length > 0) {
        const clicked = intersects.find(i => i.object.userData.clickable);
        if (clicked && clicked.object.userData.name === "aboutMe") {
          // เคลื่อนกล้องไปหน้า Project
          const startPos = camera.position.clone();
          const targetPos = new THREE.Vector3(0, 2, 2);
          const lookAtPos = new THREE.Vector3(3, 1, 0);
          const duration = 300;
          
          let frame = 0;
          //controls.enabled = false; //  ปิดการควบคุมกล้องจาก user

          function moveCamera() {
            frame++;
            const t = frame / duration;
            camera.position.lerpVectors(startPos, targetPos, t);
            controls.target.lerpVectors(controls.target.clone(), lookAtPos, t);
            controls.update();
            if (frame < duration) requestAnimationFrame(moveCamera);
          }
          moveCamera();
          preventCameraMove = true; // ✅ เปิดโหมดล็อกกล้องไม่ให้หมุน
        }

        // กด  back
        if (clicked && clicked.object.userData.name === "back") {
          const startPos = camera.position.clone();
          const targetPos = new THREE.Vector3(-9.5, 1, 0.1); // กลับไปตำแหน่งเริ่มต้น
          const lookAtPos = new THREE.Vector3(3, 1, 0);
          const duration = 300; 
          let frame = 0;

          function resetCamera() {
            frame++;
            const t = frame / duration;
            camera.position.lerpVectors(startPos, targetPos, t);
            controls.target.lerpVectors(controls.target.clone(), lookAtPos, t);
            controls.update();
            if (frame < duration) requestAnimationFrame(resetCamera);
            else controls.enabled = true; // ✅ เปิดให้หมุนกล้องได้อีกครั้งเมื่อกลับหน้าแรก
          }
          resetCamera();
          preventCameraMove = false;
        }
      }
    });

    // Render loop
    function animate() {
      requestAnimationFrame(animate);
      controls.update();
      renderer.render(scene, camera);
    }
    animate();

    window.addEventListener('resize', () => {
      camera.aspect = window.innerWidth / window.innerHeight;
      camera.updateProjectionMatrix();
      renderer.setSize(window.innerWidth, window.innerHeight);
    });
  </script>
</body>
</html>
